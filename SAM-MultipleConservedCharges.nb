(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    110657,       2644]
NotebookOptionsPosition[    105615,       2563]
NotebookOutlinePosition[    106061,       2580]
CellTagsIndexPosition[    106018,       2577]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["QCD conserved charges inside a subvolume", "Title",
 CellChangeTimes->{{3.803142945949087*^9, 
  3.803142952776188*^9}},ExpressionUUID->"5a0aa074-aad6-4df0-bc4b-\
b0f5405aac98"],

Cell[TextData[{
 StyleBox["This notebook expresses cumulants of QCD conserved charges inside \
a subvolume in terms of the grand-canonical susceptibilities, in accordance \
with the subensemble acceptance method (SAM) as obtained in a paper:\nV. \
Vovchenko, R. Poberezhnyuk, V. Koch, ", "Text",
  FontColor->GrayLevel[0]],
 StyleBox[ButtonBox["JHEP 10 (2020) 089",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://doi.org/10.1007/JHEP10(2020)089"], None},
  ButtonNote->"https://doi.org/10.1007/JHEP10(2020)089"], "Text",
  FontColor->GrayLevel[0]],
 StyleBox[" [", "Text",
  FontColor->GrayLevel[0]],
 StyleBox[ButtonBox["arXiv:2007.03850",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://arxiv.org/abs/2007.03850"], None},
  ButtonNote->"https://arxiv.org/abs/2007.03850"], "Text",
  FontColor->GrayLevel[0]],
 StyleBox["]\nMore specifically, the notebook allows to express the general \
result given in Eqs. (2.39-2.44) of the paper in the standard QCD notation.\n\
\n1. To use the notebook first all cells in the section \
\[OpenCurlyDoubleQuote]Initialization\[CloseCurlyDoubleQuote] should be \
evaluated.  The prompt to do that should appear automatically before any \
other evaluation.\n2. The \[OpenCurlyDoubleQuote]Cumulants\
\[CloseCurlyDoubleQuote] section presents several examples how to use this \
notebook to compute various QCD cumulants.\n\nPresently, the calculations are \
possible for cumulants up to 6th order.", "Text",
  FontColor->GrayLevel[0]]
}], "Subsection",
 CellChangeTimes->{{3.801075351003187*^9, 3.801075461272215*^9}, {
   3.803142564194276*^9, 3.8031425665119143`*^9}, {3.803142712730829*^9, 
   3.8031427622084403`*^9}, {3.803142799776618*^9, 3.803142933577224*^9}, {
   3.803142992490327*^9, 3.8031430802370567`*^9}, {3.803143117698844*^9, 
   3.8031431290542545`*^9}, {3.8031435461515512`*^9, 3.803143546564504*^9}, {
   3.803148388590148*^9, 3.8031483893994827`*^9}, {3.803148541605236*^9, 
   3.803148561928779*^9}, {3.8031485973275194`*^9, 3.803148634768057*^9}, {
   3.803154934445733*^9, 3.803154995561669*^9}, {3.8031575525102434`*^9, 
   3.803157576307116*^9}, 3.833564622079562*^9, {3.8335647455463076`*^9, 
   3.833564794559109*^9}, {3.8335648357605753`*^9, 3.8335648385577*^9}, {
   3.8335649117069054`*^9, 
   3.8335649188350086`*^9}},ExpressionUUID->"b0f4c533-9c70-409d-8de8-\
16c90e51e8ca"],

Cell[CellGroupData[{

Cell["Initialization", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.803137061839678*^9, 3.8031370675723863`*^9}, {
  3.803154928972636*^9, 
  3.8031549318658466`*^9}},ExpressionUUID->"b2711185-410f-454a-9f31-\
913d8c1ed75c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"indicesCanonToNoncanon", "[", 
    RowBox[{
     RowBox[{"charges_:", 
      RowBox[{"{", 
       RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], ",", 
     RowBox[{"indscanonical_:", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1"}], "}"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "is", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"is", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"is", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", "j", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"indscanonical", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", 
            RowBox[{"Length", "[", "charges", "]"}]}], "}"}]}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", "is"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.803087169381686*^9, 3.8030873800639706`*^9}, {
  3.8030874697519407`*^9, 3.8030874710508475`*^9}, {3.80308784468944*^9, 
  3.803087851175045*^9}, {3.803088206430745*^9, 3.8030882325744495`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"88458268-1b80-4b47-83ed-af99e91c65ff"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"indicesNoncanonToCanon", "[", 
    RowBox[{
     RowBox[{"charges_:", 
      RowBox[{"{", 
       RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], ",", 
     RowBox[{"is_:", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "3"}], "}"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"inds", ",", "ti"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"inds", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "charges", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"ti", "=", "1"}], ",", 
        RowBox[{"ti", "\[LessEqual]", 
         RowBox[{"Length", "[", "is", "]"}]}], ",", 
        RowBox[{"ti", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"inds", "[", 
           RowBox[{"[", 
            RowBox[{"is", "[", 
             RowBox[{"[", "ti", "]"}], "]"}], "]"}], "]"}], "++"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "inds"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenSubSuperScript", "[", 
    RowBox[{
     RowBox[{"charges_:", 
      RowBox[{"{", 
       RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], ",", 
     RowBox[{"indscanonical_:", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1"}], "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "superscript", ",", "\[IndentingNewLine]", "subscript", ",", 
       "\[IndentingNewLine]", "tabsuper", ",", "\[IndentingNewLine]", 
       "tabsub", ",", "\[IndentingNewLine]", "ind"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tabsuper", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tabsub", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"ind", "=", "1"}], ",", 
        RowBox[{"ind", "\[LessEqual]", 
         RowBox[{"Length", "[", "charges", "]"}]}], ",", 
        RowBox[{"ind", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"indscanonical", "[", 
             RowBox[{"[", "ind", "]"}], "]"}], "\[NotEqual]", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"tabsuper", ",", 
              RowBox[{"ToString", "[", 
               RowBox[{"charges", "[", 
                RowBox[{"[", "ind", "]"}], "]"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"tabsub", ",", 
              RowBox[{"ToString", "[", 
               RowBox[{"indscanonical", "[", 
                RowBox[{"[", "ind", "]"}], "]"}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"subscript", "=", 
       RowBox[{"StringJoin", "[", "tabsub", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"superscript", "=", 
       RowBox[{"StringJoin", "[", "tabsuper", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"subscript", ",", "superscript"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.80308810100745*^9, 3.8030881652307014`*^9}, {
  3.8030882367358694`*^9, 3.803088241507798*^9}, {3.8030944751954727`*^9, 
  3.8030945836875396`*^9}, {3.8030946521022153`*^9, 3.80309465484159*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"d9e5f1ff-5144-4e2d-b809-d26608197268"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"chiCanon", "[", 
    RowBox[{
     RowBox[{"charges_:", 
      RowBox[{"{", 
       RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], ",", 
     RowBox[{"indscanonical_:", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1"}], "}"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{
     "{", "\[IndentingNewLine]", "subsuperscript", "\[IndentingNewLine]", 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"ind", "=", "1"}], ",", 
        RowBox[{"ind", "\[LessEqual]", 
         RowBox[{"Length", "[", "charges", "]"}]}], ",", 
        RowBox[{"ind", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"indscanonical", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"tabsuper", ",", 
              RowBox[{"ToString", "[", 
               RowBox[{"charges", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"tabsub", ",", 
              RowBox[{"ToString", "[", 
               RowBox[{"indscanonical", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"subsuperscript", "=", 
       RowBox[{"GenSubSuperScript", "[", 
        RowBox[{"charges", ",", "indscanonical"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Subsuperscript", "[", 
       RowBox[{"\[Chi]", ",", 
        RowBox[{"subsuperscript", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"subsuperscript", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"chiCanonFromNoncanon", "[", 
    RowBox[{
     RowBox[{"charges_:", 
      RowBox[{"{", 
       RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], ",", 
     RowBox[{"is_:", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2", ",", "3"}], "}"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"indscanonical", "=", 
        RowBox[{"indicesNoncanonToCanon", "[", 
         RowBox[{"charges", ",", "is"}], "]"}]}], ",", "\[IndentingNewLine]", 
       "subsuperscript"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subsuperscript", "=", 
       RowBox[{"GenSubSuperScript", "[", 
        RowBox[{"charges", ",", "indscanonical"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Subsuperscript", "[", 
       RowBox[{"\[Chi]", ",", 
        RowBox[{"subsuperscript", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"subsuperscript", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.803087478872591*^9, 3.803087495628617*^9}, {
  3.803087631696928*^9, 3.8030877008757477`*^9}, {3.8030877472085323`*^9, 
  3.8030877982799206`*^9}, {3.803087852556737*^9, 3.80308809243606*^9}, {
  3.803088250231803*^9, 3.8030882964640656`*^9}, {3.803089081868389*^9, 
  3.803089083556765*^9}, {3.803094044137397*^9, 3.803094070939927*^9}, {
  3.803094206464798*^9, 3.803094352850579*^9}, {3.803094415922089*^9, 
  3.803094448148615*^9}, {3.8030945638651605`*^9, 3.803094628830798*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"e5d8c4ef-a127-4204-8076-af64c0a9d084"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"chi2inverseCanon", "[", 
    RowBox[{"charges_:", 
     RowBox[{"{", 
      RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "matr", ",", "\[IndentingNewLine]", "superscript", ",", 
       "\[IndentingNewLine]", "subscript", ",", "i", ",", "j"}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"matr", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"superscript", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ToString", "[", 
           RowBox[{"charges", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "charges", "]"}]}], "}"}]}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "charges", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"matr", ",", 
           RowBox[{"{", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", 
            RowBox[{"Length", "[", "charges", "]"}]}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{
              RowBox[{"matr", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Inverse", "[", "matr", "]"}], "//", "Simplify"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"chi2inverseCanonTimesDet", "[", 
    RowBox[{"charges_:", 
     RowBox[{"{", 
      RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
      "matr", ",", "\[IndentingNewLine]", "superscript", ",", 
       "\[IndentingNewLine]", "subscript", ",", "i", ",", "j"}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"matr", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"superscript", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ToString", "[", 
           RowBox[{"charges", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "charges", "]"}]}], "}"}]}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "charges", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"matr", ",", 
           RowBox[{"{", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", 
            RowBox[{"Length", "[", "charges", "]"}]}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{
              RowBox[{"matr", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Inverse", "[", "matr", "]"}], "*", 
        RowBox[{"Det", "[", "matr", "]"}]}], "//", "Simplify"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8030889919883327`*^9, 3.803089188907488*^9}, {
   3.8030892311614017`*^9, 3.8030893853820343`*^9}, 3.803091516592208*^9},
 CellLabel->"In[6]:=",ExpressionUUID->"eff48471-84b6-4b7e-ae21-de00f4c179ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"chi2inverseCanon", "[", 
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], "]"}], "[", 
  RowBox[{"[", 
   RowBox[{"1", ",", "2"}], "]"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8030892363935137`*^9, 3.8030892364495115`*^9}, {
  3.803089318010253*^9, 3.803089336708004*^9}, {3.8030893881886044`*^9, 
  3.8030894046728916`*^9}, {3.8030896327789974`*^9, 3.803089633772176*^9}, {
  3.8030906778261595`*^9, 3.803090687137975*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"5fac0b67-89b8-45b4-994e-a784646bf666"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"detchi2", "[", 
    RowBox[{"charges_:", 
     RowBox[{"{", 
      RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"matr", ",", "i", ",", "j"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"matr", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "charges", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"matr", ",", 
           RowBox[{"{", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", 
            RowBox[{"Length", "[", "charges", "]"}]}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{
              RowBox[{"matr", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"Det", "[", "matr", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.803146963120947*^9, 3.803147014851861*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"292c88ad-38fb-4d48-a12a-90ff5c5382a2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "kappaCanon", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "kappaCanon", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"KeepBeta", "\[Rule]", "False"}], ",", 
     RowBox[{"KeepDetchi2", "\[Rule]", "False"}], ",", 
     RowBox[{"PrintMode", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kappaCanon", "[", 
    RowBox[{
     RowBox[{"charges_:", 
      RowBox[{"{", 
       RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], ",", 
     RowBox[{"indscanonical_:", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", "=", 
        RowBox[{"Total", "[", "indscanonical", "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"NQ", "=", 
        RowBox[{"Length", "[", "charges", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"is", "=", 
        RowBox[{"indicesCanonToNoncanon", "[", 
         RowBox[{"charges", ",", "indscanonical"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"chi2inv", "=", 
        RowBox[{"chi2inverseCanon", "[", "charges", "]"}]}], ",", 
       "\[IndentingNewLine]", "subsuperscript", ",", "\[IndentingNewLine]", 
       "sig", ",", "\[IndentingNewLine]", 
       RowBox[{"expr", "=", "\"\<\>\""}]}], "\[IndentingNewLine]", "}"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "KeepDetchi2", "]"}], ",", 
        RowBox[{"chi2inv", "=", 
         FractionBox[
          RowBox[{"chi2inverseCanonTimesDet", "[", "charges", "]"}], 
          "\"\<D[\!\(\*SubscriptBox[\(\[Chi]\), \(2\)]\)]\>\""]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", 
           RowBox[{"chiCanonFromNoncanon", "[", 
            RowBox[{"charges", ",", "is"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", "*", 
           RowBox[{"chiCanonFromNoncanon", "[", 
            RowBox[{"charges", ",", "is"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", "*", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", "*", "\[Alpha]"}]}], ")"}], "*", 
           RowBox[{"chiCanonFromNoncanon", "[", 
            RowBox[{"charges", ",", "is"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "4"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"sig", "=", 
          RowBox[{"Permutations", "[", 
           RowBox[{"Table", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "M"}], "}"}]}], "]"}], "]"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", "*", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"3", "*", "\[Alpha]", "*", "\[Beta]"}]}], ")"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", "is"}], "]"}]}], "\[IndentingNewLine]",
              "-", 
             RowBox[{
              FractionBox[
               RowBox[{"\[Alpha]", "*", "\[Beta]"}], 
               RowBox[{
                RowBox[{"2", "!"}], "*", 
                RowBox[{"2", "!"}], "*", 
                RowBox[{"2", "!"}]}]], "*", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                     "}"}]}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b2", ",", "NQ"}], "}"}]}], "]"}]}]}], 
            "\[IndentingNewLine]", ")"}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "5"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"sig", "=", 
          RowBox[{"Permutations", "[", 
           RowBox[{"Table", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "M"}], "}"}]}], "]"}], "]"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", "*", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", "*", "\[Alpha]"}]}], ")"}], 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"2", "*", "\[Alpha]", "*", "\[Beta]"}]}], ")"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", "is"}], "]"}]}], "\[IndentingNewLine]",
              "-", 
             RowBox[{
              FractionBox[
               RowBox[{"\[Alpha]", "*", "\[Beta]"}], 
               RowBox[{
                RowBox[{"2", "!"}], "*", 
                RowBox[{"3", "!"}]}]], "*", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                     "}"}]}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b2", ",", "NQ"}], "}"}]}], "]"}]}]}], 
            "\[IndentingNewLine]", ")"}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "6"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"sig", "=", 
          RowBox[{"Permutations", "[", 
           RowBox[{"Table", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "M"}], "}"}]}], "]"}], "]"}]}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"5", "*", "\[Alpha]", "*", "\[Beta]", "*", 
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"\[Alpha]", "*", "\[Beta]"}]}], ")"}]}]}], ")"}], 
              "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", "is"}], "]"}]}], "\[IndentingNewLine]",
              "+", 
             RowBox[{
              FractionBox[
               RowBox[{
                SuperscriptBox["\[Alpha]", "2"], "*", 
                SuperscriptBox["\[Beta]", "2"]}], 
               RowBox[{
                RowBox[{"2", "!"}], "*", 
                RowBox[{"2", "!"}], "*", 
                RowBox[{"2", "!"}], "*", 
                RowBox[{"2", "!"}]}]], "*", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b1", ",", "b3"}], "]"}], "]"}], "*", 
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b2", ",", "b4"}], "]"}], "]"}], "*", 
                 "\[IndentingNewLine]", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                     "}"}]}], "]"}], "*", "\[IndentingNewLine]", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", "b3", 
                    ",", "b4"}], "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b2", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b3", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b4", ",", "NQ"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "-", 
             RowBox[{
              FractionBox[
               RowBox[{
                SuperscriptBox["\[Alpha]", "2"], "*", 
                SuperscriptBox["\[Beta]", "2"]}], 
               RowBox[{
                RowBox[{"3", "!"}], "*", 
                RowBox[{"2", "!"}], "*", 
                RowBox[{"2", "!"}], "*", 
                RowBox[{"2", "!"}]}]], "*", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b1", ",", "b4"}], "]"}], "]"}], "*", 
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b2", ",", "b5"}], "]"}], "]"}], "*", 
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b3", ",", "b6"}], "]"}], "]"}], "*", 
                 "\[IndentingNewLine]", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{"b4", ",", "b5", ",", "b6"}], "}"}]}], "]"}], "*",
                  "\[IndentingNewLine]", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", "b3"}],
                     "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b2", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b3", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b4", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b5", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b6", ",", "NQ"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "-", 
             RowBox[{
              FractionBox[
               RowBox[{"\[Alpha]", "*", "\[Beta]", "*", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"2", "*", "\[Alpha]"}]}], ")"}], "2"]}], 
               RowBox[{
                RowBox[{"2", "!"}], "*", 
                RowBox[{"3", "!"}], "*", 
                RowBox[{"3", "!"}]}]], "*", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "*", 
                 "\[IndentingNewLine]", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                     "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b2", ",", "NQ"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "-", 
             RowBox[{
              FractionBox[
               RowBox[{"\[Alpha]", "*", "\[Beta]", "*", 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"3", "*", "\[Alpha]", "*", "\[Beta]"}]}], ")"}]}], 
               RowBox[{
                RowBox[{"2", "!"}], "*", 
                RowBox[{"4", "!"}]}]], "*", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "*", 
                 "\[IndentingNewLine]", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                     "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b2", ",", "NQ"}], "}"}]}], "]"}]}]}], 
            "\[IndentingNewLine]", ")"}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"OptionValue", "[", "KeepBeta", "]"}], "]"}], ",", 
        RowBox[{"expr", "=", 
         RowBox[{"expr", "/.", 
          RowBox[{"\[Beta]", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"1", "-", "\[Alpha]"}], ")"}]}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "PrintMode", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"subsuperscript", "=", 
          RowBox[{"GenSubSuperScript", "[", 
           RowBox[{"charges", ",", "indscanonical"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{
           RowBox[{"Subsuperscript", "[", 
            RowBox[{"\[Kappa]", ",", 
             RowBox[{"subsuperscript", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"subsuperscript", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "==", "expr"}], "]"}], 
         ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "expr", "]"}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8030896565563817`*^9, 3.8030897193567815`*^9}, {
   3.803089781237836*^9, 3.8030897924659767`*^9}, {3.803089828376021*^9, 
   3.8030898532334547`*^9}, {3.8030898860904446`*^9, 3.803089987035024*^9}, 
   3.803090028423232*^9, {3.8030900687781963`*^9, 3.803090112966713*^9}, {
   3.80309020294246*^9, 3.803090351486644*^9}, {3.803090425600678*^9, 
   3.8030905521972*^9}, {3.8030905868432407`*^9, 3.803090671801*^9}, {
   3.8030907200237093`*^9, 3.80309089142008*^9}, {3.8030909385559998`*^9, 
   3.80309098745848*^9}, {3.803091029911334*^9, 3.803091110022259*^9}, {
   3.8030911650539875`*^9, 3.8030911674807577`*^9}, {3.8030912139119625`*^9, 
   3.8030912539387007`*^9}, {3.8030915305140524`*^9, 3.803091573650532*^9}, {
   3.80309164097457*^9, 3.803091659159176*^9}, {3.803092034926562*^9, 
   3.8030920374506135`*^9}, {3.803092068440716*^9, 3.803092135209603*^9}, {
   3.8030922409117737`*^9, 3.8030923663436623`*^9}, {3.80309240020947*^9, 
   3.8030924315390673`*^9}, {3.80309250300125*^9, 3.8030927741911926`*^9}, {
   3.803093589012086*^9, 3.803093629113083*^9}, {3.803093789262101*^9, 
   3.8030937918018007`*^9}, {3.803098410238662*^9, 3.803098412580947*^9}, {
   3.803098547460329*^9, 3.8030985519908943`*^9}, {3.8031370884355683`*^9, 
   3.803137231983247*^9}, {3.80313730967564*^9, 3.803137310097515*^9}, 
   3.8031432456033163`*^9, {3.8031454911111865`*^9, 3.803145491915045*^9}, {
   3.8031468593698463`*^9, 3.803146864363969*^9}, {3.803157641027932*^9, 
   3.803157665317482*^9}},ExpressionUUID->"5d75cfee-0d6a-47b0-baf1-\
23696d388bba"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"UniquePermutations", "[", 
    RowBox[{"M_", ",", 
     RowBox[{"sets_:", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"permut", "=", 
        RowBox[{"Permutations", "[", 
         RowBox[{"Table", "[", 
          RowBox[{"i", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "M"}], "}"}]}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"permut2", "=", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "ind", ",", 
       "\[IndentingNewLine]", "ind2", ",", "\[IndentingNewLine]", "ci"}], 
      "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"ind", "=", "1"}], ",", 
        RowBox[{"ind", "\[LessEqual]", 
         RowBox[{"Length", "[", "permut", "]"}]}], ",", 
        RowBox[{"ind", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"permut2", ",", 
           RowBox[{"{", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"ci", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"ind2", "=", "1"}], ",", 
           RowBox[{"ind2", "\[LessEqual]", 
            RowBox[{"Length", "[", "sets", "]"}]}], ",", 
           RowBox[{"ind2", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{
              RowBox[{"permut2", "[", 
               RowBox[{"[", "ind", "]"}], "]"}], ",", 
              RowBox[{"Sort", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"permut", "[", 
                   RowBox[{"[", "ind", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"ci", "+", "i"}], "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"sets", "[", 
                    RowBox[{"[", "ind2", "]"}], "]"}]}], "}"}]}], "]"}], 
               "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ci", "+=", 
             RowBox[{"sets", "[", 
              RowBox[{"[", "ind2", "]"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"permut2", "=", 
       RowBox[{"DeleteDuplicates", "[", "permut2", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"ind", "=", "1"}], ",", 
        RowBox[{"ind", "\[LessEqual]", 
         RowBox[{"Length", "[", "permut2", "]"}]}], ",", 
        RowBox[{"ind", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"permut2", "[", 
           RowBox[{"[", "ind", "]"}], "]"}], "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"permut2", "[", 
            RowBox[{"[", "ind", "]"}], "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "permut2"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellLabel->"In[13]:=",ExpressionUUID->"f58c2650-2779-4bc1-b01d-442d9eb5e8e9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "kappaCanonUP", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "kappaCanonUP", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"KeepBeta", "\[Rule]", "False"}], ",", 
     RowBox[{"KeepDetchi2", "\[Rule]", "False"}], ",", 
     RowBox[{"PrintMode", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kappaCanonUP", "[", 
    RowBox[{
     RowBox[{"charges_:", 
      RowBox[{"{", 
       RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], ",", 
     RowBox[{"indscanonical_:", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", "=", 
        RowBox[{"Total", "[", "indscanonical", "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"NQ", "=", 
        RowBox[{"Length", "[", "charges", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"is", "=", 
        RowBox[{"indicesCanonToNoncanon", "[", 
         RowBox[{"charges", ",", "indscanonical"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"chi2inv", "=", 
        RowBox[{"chi2inverseCanon", "[", "charges", "]"}]}], ",", 
       "\[IndentingNewLine]", "subsuperscript", ",", "\[IndentingNewLine]", 
       "sig", ",", "\[IndentingNewLine]", 
       RowBox[{"expr", "=", "\"\<\>\""}]}], "\[IndentingNewLine]", "}"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "KeepDetchi2", "]"}], ",", 
        RowBox[{"chi2inv", "=", 
         FractionBox[
          RowBox[{"chi2inverseCanonTimesDet", "[", "charges", "]"}], 
          "\"\<D[\!\(\*SubscriptBox[\(\[Chi]\), \(2\)]\)]\>\""]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", 
           RowBox[{"chiCanonFromNoncanon", "[", 
            RowBox[{"charges", ",", "is"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", "*", 
           RowBox[{"chiCanonFromNoncanon", "[", 
            RowBox[{"charges", ",", "is"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", "*", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", "*", "\[Alpha]"}]}], ")"}], "*", 
           RowBox[{"chiCanonFromNoncanon", "[", 
            RowBox[{"charges", ",", "is"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "4"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"sig", "=", 
          RowBox[{"UniquePermutations", "[", 
           RowBox[{"M", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", "*", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"3", "*", "\[Alpha]", "*", "\[Beta]"}]}], ")"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", "is"}], "]"}]}], "\[IndentingNewLine]",
              "-", 
             RowBox[{
              FractionBox[
               RowBox[{"\[Alpha]", "*", "\[Beta]"}], 
               RowBox[{"2", "!"}]], "*", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                     "}"}]}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b2", ",", "NQ"}], "}"}]}], "]"}]}]}], 
            "\[IndentingNewLine]", ")"}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "5"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"sig", "=", 
          RowBox[{"UniquePermutations", "[", 
           RowBox[{"M", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "3"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"expr", "=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]", "*", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", "*", "\[Alpha]"}]}], ")"}], 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"2", "*", "\[Alpha]", "*", "\[Beta]"}]}], ")"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", "is"}], "]"}]}], "\[IndentingNewLine]",
              "-", 
             RowBox[{"\[Alpha]", "*", "\[Beta]", "*", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"chi2inv", "[", 
                  RowBox[{"[", 
                   RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                     "}"}]}], "]"}], "*", 
                 RowBox[{"chiCanonFromNoncanon", "[", 
                  RowBox[{"charges", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"is", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                     "}"}]}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b2", ",", "NQ"}], "}"}]}], "]"}]}]}], 
            "\[IndentingNewLine]", ")"}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"M", "\[Equal]", "6"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"expr", "=", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"5", "*", "\[Alpha]", "*", "\[Beta]", "*", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"\[Alpha]", "*", "\[Beta]"}]}], ")"}]}]}], ")"}], "*", 
           RowBox[{"chiCanonFromNoncanon", "[", 
            RowBox[{"charges", ",", "is"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sig", "=", 
          RowBox[{"UniquePermutations", "[", 
           RowBox[{"M", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"expr", "+=", 
          RowBox[{
           FractionBox[
            RowBox[{
             SuperscriptBox["\[Alpha]", "2"], "*", 
             SuperscriptBox["\[Beta]", "2"]}], 
            RowBox[{"2", "!"}]], "*", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"chi2inv", "[", 
               RowBox[{"[", 
                RowBox[{"b1", ",", "b3"}], "]"}], "]"}], "*", 
              RowBox[{"chi2inv", "[", 
               RowBox[{"[", 
                RowBox[{"b2", ",", "b4"}], "]"}], "]"}], "*", 
              "\[IndentingNewLine]", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                  "}"}]}], "]"}], "*", "\[IndentingNewLine]", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                  "}"}]}], "]"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", "b3", 
                  ",", "b4"}], "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b2", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b3", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b4", ",", "NQ"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sig", "=", 
          RowBox[{"UniquePermutations", "[", 
           RowBox[{"M", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "2", ",", "2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"expr", "+=", 
          RowBox[{
           RowBox[{"-", 
            FractionBox[
             RowBox[{
              SuperscriptBox["\[Alpha]", "2"], "*", 
              SuperscriptBox["\[Beta]", "2"]}], 
             RowBox[{"3", "!"}]]}], "*", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"chi2inv", "[", 
               RowBox[{"[", 
                RowBox[{"b1", ",", "b4"}], "]"}], "]"}], "*", 
              RowBox[{"chi2inv", "[", 
               RowBox[{"[", 
                RowBox[{"b2", ",", "b5"}], "]"}], "]"}], "*", 
              RowBox[{"chi2inv", "[", 
               RowBox[{"[", 
                RowBox[{"b3", ",", "b6"}], "]"}], "]"}], "*", 
              "\[IndentingNewLine]", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{"b4", ",", "b5", ",", "b6"}], "}"}]}], "]"}], "*", 
              "\[IndentingNewLine]", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                  "}"}]}], "]"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                  "}"}]}], "]"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", "b3"}],
                  "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b2", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b3", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b4", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b5", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b6", ",", "NQ"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sig", "=", 
          RowBox[{"UniquePermutations", "[", 
           RowBox[{"M", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "3"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"expr", "+=", 
          RowBox[{
           RowBox[{"-", 
            FractionBox[
             RowBox[{"\[Alpha]", "*", "\[Beta]", "*", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{"2", "*", "\[Alpha]"}]}], ")"}], "2"]}], 
             RowBox[{"2", "!"}]]}], "*", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"chi2inv", "[", 
               RowBox[{"[", 
                RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "*", 
              "\[IndentingNewLine]", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                  "}"}]}], "]"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                  "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b2", ",", "NQ"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sig", "=", 
          RowBox[{"UniquePermutations", "[", 
           RowBox[{"M", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "4"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"expr", "+=", 
          RowBox[{
           RowBox[{"-", "\[Alpha]"}], "*", "\[Beta]", "*", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"3", "*", "\[Alpha]", "*", "\[Beta]"}]}], ")"}], "*", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"chi2inv", "[", 
               RowBox[{"[", 
                RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "*", 
              "\[IndentingNewLine]", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", "b1"}],
                  "}"}]}], "]"}], "*", 
              RowBox[{"chiCanonFromNoncanon", "[", 
               RowBox[{"charges", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "5", "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"is", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"sig", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "]"}], "]"}], ",", "b2"}],
                  "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "sig", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b1", ",", "NQ"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b2", ",", "NQ"}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"expr", "*=", 
          RowBox[{"\[Alpha]", "*", "V", "*", 
           SuperscriptBox["T", "3"], "*", "\[Beta]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"OptionValue", "[", "KeepBeta", "]"}], "]"}], ",", 
        RowBox[{"expr", "=", 
         RowBox[{"expr", "/.", 
          RowBox[{"\[Beta]", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"1", "-", "\[Alpha]"}], ")"}]}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "PrintMode", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"subsuperscript", "=", 
          RowBox[{"GenSubSuperScript", "[", 
           RowBox[{"charges", ",", "indscanonical"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{
           RowBox[{"Subsuperscript", "[", 
            RowBox[{"\[Kappa]", ",", 
             RowBox[{"subsuperscript", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"subsuperscript", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "==", "expr"}], "]"}], 
         ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "expr", "]"}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8030972330242605`*^9, 3.8030972849036436`*^9}, {
  3.8030973194436207`*^9, 3.8030973977944174`*^9}, {3.803097430691826*^9, 
  3.8030975089288244`*^9}, {3.803137269063225*^9, 3.8031373162101736`*^9}, {
  3.8031454981843643`*^9, 3.8031454987536182`*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"9b788250-2714-4336-8467-449492a3205b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "kappa", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kappa", "::", "emptycharges"}], "=", 
   "\"\<Vector of conserved charges appears to be empty!\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kappa", "::", "indicesmismatch"}], "=", 
   "\"\<The number of conserved charges `1` does not match the number of \
indices `2`\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kappa", "::", "orderhigh"}], "=", 
   "\"\<Cumulant order `1` is too high! Presently only cumulants up to 6th \
order are supported\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kappa", "::", "orderzero"}], "=", 
   "\"\<Please consider a cumulant of a non-zero order\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "kappa", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"KeepBeta", "\[Rule]", "False"}], ",", 
     RowBox[{"KeepDetchi2", "\[Rule]", "False"}], ",", 
     RowBox[{"PrintMode", "\[Rule]", "False"}], ",", 
     RowBox[{"FastMode", "\[Rule]", "True"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"kappa", "[", 
    RowBox[{
     RowBox[{"charges_:", 
      RowBox[{"{", 
       RowBox[{"B", ",", "Q", ",", "S"}], "}"}]}], ",", 
     RowBox[{"indscanonical_:", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "charges", "]"}], "\[Equal]", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"kappa", "::", "emptycharges"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "charges", "]"}], "\[NotEqual]", 
         RowBox[{"Length", "[", "indscanonical", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"kappa", "::", "indicesmismatch"}], ",", 
           RowBox[{"Length", "[", "charges", "]"}], ",", 
           RowBox[{"Length", "[", "indscanonical", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Total", "[", "indscanonical", "]"}], ">", "6"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"kappa", "::", "orderhigh"}], ",", 
           RowBox[{"Total", "[", "indscanonical", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Total", "[", "indscanonical", "]"}], "\[Equal]", "0"}], ",",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"kappa", "::", "orderzero"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "FastMode", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{"kappaCanonUP", "[", 
           RowBox[{"charges", ",", "indscanonical", ",", "opts"}], "]"}], 
          "]"}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Return", "[", 
          RowBox[{"kappaCanon", "[", 
           RowBox[{"charges", ",", "indscanonical", ",", "opts"}], "]"}], 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.803143265532892*^9, 3.8031432846321063`*^9}, {
  3.8031434188790703`*^9, 3.8031435304147177`*^9}, {3.8031439581769466`*^9, 
  3.8031439648253975`*^9}, {3.803144112538541*^9, 3.803144115658253*^9}, {
  3.803145508008704*^9, 3.8031455110983095`*^9}, {3.8031576728597803`*^9, 
  3.8031576840843844`*^9}, {3.8031577874885063`*^9, 3.803157807861785*^9}, {
  3.8031578954109144`*^9, 3.803158161417425*^9}, {3.803158198120852*^9, 
  3.8031582190476847`*^9}, {3.8031585281315722`*^9, 
  3.803158530151005*^9}},ExpressionUUID->"8d1e6629-fce1-42e5-8c2b-\
6e99745483bf"]
}, Closed]],

Cell[CellGroupData[{

Cell["Cumulants", "Section",
 CellChangeTimes->{{3.803137079372801*^9, 3.803137080095867*^9}, {
  3.803154987615325*^9, 
  3.803154988737355*^9}},ExpressionUUID->"880becc2-7f41-4eda-aa02-\
8208e129a0f5"],

Cell["\<\
Function kappa outputs the cumulants. It takes two input parameters: a vector \
of conserved charges and a vector of cumulant indices. In addition, a number \
of options can be used to customize the output. Please see the examples below \
\>", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 
  3.80314366981015*^9}},ExpressionUUID->"41e003e0-c2fe-40d3-b2aa-\
1b2db6161d93"],

Cell[CellGroupData[{

Cell["Single conserved charge", "Subsection",
 CellChangeTimes->{{3.8031436783787746`*^9, 
  3.803143687007457*^9}},ExpressionUUID->"d87a0dd9-8cd8-4f42-979f-\
6ad088d362c9"],

Cell["Let us have a single conserved charge: baryon number B.", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 
  3.8031437109141955`*^9}},ExpressionUUID->"d97d7823-6322-41c9-bcef-\
5d52c22aea00"],

Cell["Output the first six cumulants.", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803143754629432*^9, 
  3.803143773522983*^9}},ExpressionUUID->"2442b1c9-6d71-4477-bb2e-\
dc412332ca46"],

Cell[BoxData[{
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "1", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "2", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "3", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "4", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "5", "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "6", "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8031437260696774`*^9, 3.803143731639883*^9}, {
  3.803143777404667*^9, 3.8031438147123103`*^9}, {3.803146655358966*^9, 
  3.8031466610108356`*^9}, {3.8031468265339556`*^9, 3.8031468440966964`*^9}, {
  3.8031550303512373`*^9, 3.803155035120409*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"53741fc1-3d60-4598-97f5-d827b4607dd8"],

Cell["\<\
Use \[OpenCurlyDoubleQuote]KeepBeta->True\[CloseCurlyDoubleQuote] option to \
keep \[Beta]=1-\[Alpha] from unwrapping, resulting in a more concise notation
Use \[OpenCurlyDoubleQuote]PrintMode->True\[CloseCurlyDoubleQuote] to output \
the result as an equation \[Kappa]==...\
\>", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803143754629432*^9, 3.803143773522983*^9}, {3.803143833682547*^9, 
  3.8031438850414743`*^9}, {3.803146886647753*^9, 
  3.8031469216244893`*^9}},ExpressionUUID->"a5e8535e-1ffa-4c11-be3c-\
b30f57fc57de"],

Cell[BoxData[{
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "1", "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "2", "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "3", "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "4", "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "5", "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", "B", "}"}], ",", 
   RowBox[{"{", "6", "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.803143891132677*^9, 3.8031439284790864`*^9}, {
  3.8031441244039965`*^9, 3.8031441504950047`*^9}, {3.8031469025570793`*^9, 
  3.8031469119031334`*^9}, {3.803155037247306*^9, 3.803155039875596*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"46b113eb-844c-4451-837a-3abffcef8662"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Two conserved charges", "Subsection",
 CellChangeTimes->{{3.8031436783787746`*^9, 3.803143687007457*^9}, {
  3.8031441733370543`*^9, 
  3.8031441750352335`*^9}},ExpressionUUID->"eb496acc-cd68-4269-8483-\
a9e42e376e79"],

Cell["Two conserved charges: B and Q", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 
  3.8031442154216547`*^9}},ExpressionUUID->"2ee17b48-f49c-4d05-badf-\
eb8be949320f"],

Cell["\<\
The expressions are the same as in a single charge case for cumulants up to \
3rd order\
\>", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
  3.8031444391298704`*^9}},ExpressionUUID->"f70e10e1-28b2-40d3-bea0-\
7c706e22cd25"],

Cell[BoxData[{
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.803144249430833*^9, 3.8031442756937675`*^9}, {
  3.8031443932684383`*^9, 3.8031444050076294`*^9}, {3.8031469318950944`*^9, 
  3.803146933033763*^9}, {3.803155049035737*^9, 3.803155050122356*^9}},
 CellLabel->"In[64]:=",ExpressionUUID->"eda7cb32-989a-4131-bbe0-e2adbf1fd8a6"],

Cell["From 4th order things get more involved", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
  3.803144468850414*^9}},ExpressionUUID->"f50f293c-c85e-4926-9ccf-\
7504d1553438"],

Cell[BoxData[{
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.803144474327814*^9, 3.8031445281497903`*^9}, {
  3.803146936023981*^9, 3.803146937304776*^9}, {3.8031550516155996`*^9, 
  3.8031550526678505`*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"1e2a426e-dc0f-4f54-8bd8-f65c12b610ff"],

Cell[TextData[{
 "Use \[OpenCurlyDoubleQuote]KeepDetchi2\[Rule]True\[CloseCurlyDoubleQuote] \
option to keep the notation more concise. ",
 Cell[BoxData[
  FormBox[
   RowBox[{"D", "[", 
    SubscriptBox["\[Chi]", "2"], "]"}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "bc5ee0b2-48b4-4fbe-9722-0976fcaf0fad"],
 " is the determinant of the 2nd order susceptibility matrix"
}], "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
  3.803144468850414*^9}, {3.8031445372251873`*^9, 
  3.803144587432294*^9}},ExpressionUUID->"3896fa07-1d5c-43d3-ad7a-\
d074282a77a4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<D[\!\(\*SubscriptBox[\(\[Chi]\), \(2\)]\)] == \>\"", ",", 
    RowBox[{"detchi2", "[", 
     RowBox[{"{", 
      RowBox[{"B", ",", "Q"}], "}"}], "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.803144597727773*^9, 3.803144638614593*^9}, {
  3.8031469446757417`*^9, 3.803146946191501*^9}, {3.803147044370588*^9, 
  3.803147074583375*^9}, {3.8031550533869305`*^9, 3.8031550546159563`*^9}, {
  3.8031550945940714`*^9, 
  3.803155095861681*^9}},ExpressionUUID->"922e561b-3146-4b1d-ba2a-\
52c4fc3148a7"],

Cell[TextData[{
 "Kurtosis ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Kappa]", "4"], "/", 
    SubscriptBox["\[Kappa]", "2"]}], TraditionalForm]],
  FormatType->"TraditionalForm",ExpressionUUID->
  "f7c8195b-7fe0-46e8-9378-61959649957b"]
}], "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
  3.803144468850414*^9}, {3.8031455340605793`*^9, 
  3.803145544421135*^9}},ExpressionUUID->"5ef72cb8-602d-4b5d-8e80-\
19fce7dc34fc"],

Cell[BoxData[{
 RowBox[{"Print", "[", 
  RowBox[{
  "\"\<\!\(\*FractionBox[SubsuperscriptBox[\(\[Kappa]\), \(4\), \(B\)], \
SubsuperscriptBox[\(\[Kappa]\), \(2\), \(B\)]]\) == \>\"", ",", 
   RowBox[{
    FractionBox[
     RowBox[{"kappa", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"B", ",", "Q"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "0"}], "}"}], ",", 
       RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
       RowBox[{"KeepDetchi2", "\[Rule]", "True"}]}], "]"}], 
     RowBox[{"kappa", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"B", ",", "Q"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "0"}], "}"}], ",", 
       RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
       RowBox[{"KeepDetchi2", "\[Rule]", "True"}]}], "]"}]], "//", 
    "FullSimplify"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{
  "\"\<\!\(\*FractionBox[SubsuperscriptBox[\(\[Kappa]\), \(4\), \(Q\)], \
SubsuperscriptBox[\(\[Kappa]\), \(2\), \(Q\)]]\) == \>\"", ",", 
   RowBox[{
    FractionBox[
     RowBox[{"kappa", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"B", ",", "Q"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "4"}], "}"}], ",", 
       RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
       RowBox[{"KeepDetchi2", "\[Rule]", "True"}]}], "]"}], 
     RowBox[{"kappa", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"B", ",", "Q"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "2"}], "}"}], ",", 
       RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
       RowBox[{"KeepDetchi2", "\[Rule]", "True"}]}], "]"}]], "//", 
    "FullSimplify"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.803145552726405*^9, 3.803145581526887*^9}, {
  3.803147083074133*^9, 3.8031471543231573`*^9}, {3.803155055748914*^9, 
  3.803155058422087*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"9c9854fe-2c8d-4079-a14e-47fa54a3a699"],

Cell["5th order", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
  3.803144468850414*^9}, {3.8031445372251873`*^9, 3.803144587432294*^9}, {
  3.803144668128063*^9, 
  3.8031446692011967`*^9}},ExpressionUUID->"32ea65fb-8fa3-492d-a1fe-\
1e8183058b2e"],

Cell[BoxData[{
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "1"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "2"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.803144675138877*^9, 3.8031446775455217`*^9}, {
  3.803148454350111*^9, 3.8031484555337105`*^9}, {3.80315506025978*^9, 
  3.8031550614271913`*^9}},
 CellLabel->"In[76]:=",ExpressionUUID->"b0eb11dc-0055-484a-8a50-01f3cfd40bbf"],

Cell["6th order. Expressions can get very lengthy.", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
   3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
   3.803144468850414*^9}, {3.8031445372251873`*^9, 3.803144587432294*^9}, {
   3.803144668128063*^9, 3.8031446692011967`*^9}, 3.803144728731641*^9, {
   3.8031451577014008`*^9, 
   3.8031451672411804`*^9}},ExpressionUUID->"6de19a07-2990-40da-b0d0-\
7478f0fd67dd"],

Cell[BoxData[{
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"kappa", "[", 
     RowBox[{"chargesBQ", ",", 
      RowBox[{"{", 
       RowBox[{"5", ",", "1"}], "}"}], ",", 
      RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
      RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
      RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"kappa", "[", 
     RowBox[{"chargesBQ", ",", 
      RowBox[{"{", 
       RowBox[{"4", ",", "2"}], "}"}], ",", 
      RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
      RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
      RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.8031447331924596`*^9, 3.8031447561587706`*^9}, 
   3.8031451365824127`*^9, {3.8031452412248297`*^9, 3.803145242060273*^9}, {
   3.803147178943277*^9, 3.803147211276572*^9}, 3.8031550621871157`*^9},
 CellLabel->"In[79]:=",ExpressionUUID->"74c84526-3ba0-4ad0-be61-c74da2964f09"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Three conserved charges", "Subsection",
 CellChangeTimes->{{3.8031436783787746`*^9, 3.803143687007457*^9}, {
  3.8031441733370543`*^9, 3.8031441750352335`*^9}, {3.803145264916583*^9, 
  3.803145265459564*^9}},ExpressionUUID->"68569757-536d-4083-8bb3-\
a8e0fb89adfb"],

Cell["Three conserved charges: B, Q, S", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031452678012323`*^9, 
  3.8031452694426055`*^9}, {3.8031456567941456`*^9, 
  3.8031456573651114`*^9}},ExpressionUUID->"b0b18ea8-59ce-4ed5-a5d0-\
db186df13c3c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<D[\!\(\*SubscriptBox[\(\[Chi]\), \(2\)]\)] == \>\"", ",", 
    RowBox[{"detchi2", "[", 
     RowBox[{"{", 
      RowBox[{"B", ",", "Q", ",", "S"}], "}"}], "]"}]}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8031452909396152`*^9, 3.803145313185787*^9}, {
  3.8031472528429403`*^9, 3.8031472553776073`*^9}, {3.803155068319754*^9, 
  3.803155072183364*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"96fef21e-0ac3-47cb-8a5a-79f2dc1df2c5"],

Cell["4th order", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
  3.803144468850414*^9}, {3.8031461440290875`*^9, 
  3.8031461742400064`*^9}},ExpressionUUID->"29e22c26-6af5-4a52-8e2f-\
40be253c02c0"],

Cell[BoxData[{
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q", ",", "S"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q", ",", "S"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q", ",", "S"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8031452968264074`*^9, 3.8031453295144744`*^9}, {
  3.803145665642578*^9, 3.8031457052889614`*^9}, {3.8031457392415915`*^9, 
  3.803145821336832*^9}, {3.803145872607933*^9, 3.803145929863773*^9}, {
  3.8031461564165745`*^9, 3.803146162136264*^9}, {3.803147223011979*^9, 
  3.803147242391881*^9}, {3.8031550741690917`*^9, 3.803155075162435*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"531d8e84-4391-4ba4-8043-879df551c8c6"],

Cell["5th order", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
  3.803144468850414*^9}, {3.8031461440290875`*^9, 
  3.8031461879748545`*^9}},ExpressionUUID->"6f06fa13-d8ab-4cc9-8aa7-\
2e7ecd847533"],

Cell[BoxData[{
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q", ",", "S"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q", ",", "S"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "1", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q", ",", "S"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "1", ",", "1"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8031462065920134`*^9, 3.803146238099264*^9}, 
   3.803146273272216*^9, 3.803146466827743*^9, {3.8031472668467293`*^9, 
   3.803147283295185*^9}, {3.803155076990196*^9, 3.803155077997258*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"f174efce-4a08-48b3-b084-c23fb802e5c3"],

Cell["\<\
6th order. Calculations can take up to a few minutes and expression can get \
very lengthy\
\>", "Text",
 CellChangeTimes->{{3.8031435745533113`*^9, 3.8031437109141955`*^9}, {
  3.803144207135153*^9, 3.8031442154216547`*^9}, {3.8031444139661207`*^9, 
  3.803144468850414*^9}, {3.8031461440290875`*^9, 3.8031461879748545`*^9}, {
  3.803146285850746*^9, 3.8031463236541557`*^9}, {3.8031465021036463`*^9, 
  3.803146507291992*^9}},ExpressionUUID->"4fd74434-49b1-401c-84d3-\
e5a4fa65579f"],

Cell[BoxData[
 RowBox[{"kappa", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"B", ",", "Q", ",", "S"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"KeepBeta", "\[Rule]", "True"}], ",", 
   RowBox[{"KeepDetchi2", "\[Rule]", "True"}], ",", 
   RowBox[{"PrintMode", "\[Rule]", "True"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.803146293795861*^9, 3.8031463177599144`*^9}, 
   3.80314650967533*^9, {3.8031473041875362`*^9, 3.803147317649044*^9}, 
   3.803155080445525*^9},
 CellLabel->"In[87]:=",ExpressionUUID->"fa10fc7c-59e8-442b-a71d-eb629c7eef47"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1141.875, 543.},
WindowMargins->{{Automatic, -135}, {Automatic, -721.125}},
Magnification:>0.9 Inherited,
FrontEndVersion->"12.2 for Microsoft Windows (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"8e7fb78e-ed38-480f-87bc-402598253a30"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 183, 3, 87, "Title",ExpressionUUID->"5a0aa074-aad6-4df0-bc4b-b0f5405aac98"],
Cell[766, 27, 2364, 43, 208, "Subsection",ExpressionUUID->"b0f4c533-9c70-409d-8de8-16c90e51e8ca"],
Cell[CellGroupData[{
Cell[3155, 74, 239, 5, 47, "Section",ExpressionUUID->"b2711185-410f-454a-9f31-913d8c1ed75c",
 InitializationCell->True],
Cell[3397, 81, 1493, 38, 131, "Input",ExpressionUUID->"88458268-1b80-4b47-83ed-af99e91c65ff",
 InitializationCell->True],
Cell[4893, 121, 3978, 101, 509, "Input",ExpressionUUID->"d9e5f1ff-5144-4e2d-b809-d26608197268",
 InitializationCell->True],
Cell[8874, 224, 3842, 95, 365, "Input",ExpressionUUID->"e5d8c4ef-a127-4204-8076-af64c0a9d084",
 InitializationCell->True],
Cell[12719, 321, 4860, 120, 563, "Input",ExpressionUUID->"eff48471-84b6-4b7e-ae21-de00f4c179ca",
 InitializationCell->True],
Cell[17582, 443, 569, 12, 40, "Input",ExpressionUUID->"5fac0b67-89b8-45b4-994e-a784646bf666",
 InitializationCell->True],
Cell[18154, 457, 1804, 45, 203, "Input",ExpressionUUID->"292c88ad-38fb-4d48-a12a-90ff5c5382a2",
 InitializationCell->True],
Cell[19961, 504, 28600, 652, 1658, "Input",ExpressionUUID->"5d75cfee-0d6a-47b0-baf1-23696d388bba",
 InitializationCell->True],
Cell[48564, 1158, 3422, 83, 419, "Input",ExpressionUUID->"f58c2650-2779-4bc1-b01d-442d9eb5e8e9",
 InitializationCell->True],
Cell[51989, 1243, 26682, 631, 1560, "Input",ExpressionUUID->"9b788250-2714-4336-8467-449492a3205b",
 InitializationCell->True],
Cell[78674, 1876, 4955, 124, 545, "Input",ExpressionUUID->"8d1e6629-fce1-42e5-8c2b-6e99745483bf",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[83666, 2005, 203, 4, 47, "Section",ExpressionUUID->"880becc2-7f41-4eda-aa02-8208e129a0f5"],
Cell[83872, 2011, 388, 7, 52, "Text",ExpressionUUID->"41e003e0-c2fe-40d3-b2aa-1b2db6161d93"],
Cell[CellGroupData[{
Cell[84285, 2022, 173, 3, 48, "Subsection",ExpressionUUID->"d87a0dd9-8cd8-4f42-979f-6ad088d362c9"],
Cell[84461, 2027, 201, 3, 31, "Text",ExpressionUUID->"d97d7823-6322-41c9-bcef-5d52c22aea00"],
Cell[84665, 2032, 226, 4, 31, "Text",ExpressionUUID->"2442b1c9-6d71-4477-bb2e-dc412332ca46"],
Cell[84894, 2038, 1131, 29, 113, "Input",ExpressionUUID->"53741fc1-3d60-4598-97f5-d827b4607dd8"],
Cell[86028, 2069, 576, 10, 52, "Text",ExpressionUUID->"a5e8535e-1ffa-4c11-be3c-b30f57fc57de"],
Cell[86607, 2081, 1686, 40, 113, "Input",ExpressionUUID->"46b113eb-844c-4451-837a-3abffcef8662"]
}, Open  ]],
Cell[CellGroupData[{
Cell[88330, 2126, 224, 4, 48, "Subsection",ExpressionUUID->"eb496acc-cd68-4269-8483-a9e42e376e79"],
Cell[88557, 2132, 227, 4, 31, "Text",ExpressionUUID->"2ee17b48-f49c-4d05-badf-eb8be949320f"],
Cell[88787, 2138, 342, 7, 31, "Text",ExpressionUUID->"f70e10e1-28b2-40d3-bea0-7c706e22cd25"],
Cell[89132, 2147, 1141, 28, 61, "Input",ExpressionUUID->"eda7cb32-989a-4131-bbe0-e2adbf1fd8a6"],
Cell[90276, 2177, 284, 4, 31, "Text",ExpressionUUID->"f50f293c-c85e-4926-9ccf-7504d1553438"],
Cell[90563, 2183, 1093, 28, 63, "Input",ExpressionUUID->"1e2a426e-dc0f-4f54-8bd8-f65c12b610ff"],
Cell[91659, 2213, 691, 15, 31, "Text",ExpressionUUID->"3896fa07-1d5c-43d3-ad7a-d074282a77a4"],
Cell[92353, 2230, 1576, 40, 81, "Input",ExpressionUUID->"922e561b-3146-4b1d-ba2a-52c4fc3148a7"],
Cell[93932, 2272, 547, 14, 31, "Text",ExpressionUUID->"5ef72cb8-602d-4b5d-8e80-19fce7dc34fc"],
Cell[94482, 2288, 1944, 50, 98, "Input",ExpressionUUID->"9c9854fe-2c8d-4079-a14e-47fa54a3a699"],
Cell[96429, 2340, 356, 6, 31, "Text",ExpressionUUID->"32ea65fb-8fa3-492d-a1fe-1e8183058b2e"],
Cell[96788, 2348, 1251, 31, 63, "Input",ExpressionUUID->"b0eb11dc-0055-484a-8a50-01f3cfd40bbf"],
Cell[98042, 2381, 471, 7, 31, "Text",ExpressionUUID->"6de19a07-2990-40da-b0d0-7478f0fd67dd"],
Cell[98516, 2390, 1318, 31, 63, "Input",ExpressionUUID->"74c84526-3ba0-4ad0-be61-c74da2964f09"]
}, Open  ]],
Cell[CellGroupData[{
Cell[99871, 2426, 272, 4, 48, "Subsection",ExpressionUUID->"68569757-536d-4083-8bb3-a8e0fb89adfb"],
Cell[100146, 2432, 332, 5, 31, "Text",ExpressionUUID->"b0b18ea8-59ce-4ed5-a5d0-db186df13c3c"],
Cell[100481, 2439, 504, 11, 26, "Input",ExpressionUUID->"96fef21e-0ac3-47cb-8a5a-79f2dc1df2c5"],
Cell[100988, 2452, 307, 5, 31, "Text",ExpressionUUID->"29e22c26-6af5-4a52-8e2f-40be253c02c0"],
Cell[101298, 2459, 1508, 33, 63, "Input",ExpressionUUID->"531d8e84-4391-4ba4-8043-879df551c8c6"],
Cell[102809, 2494, 307, 5, 31, "Text",ExpressionUUID->"6f06fa13-d8ab-4cc9-8aa7-2e7ecd847533"],
Cell[103119, 2501, 1356, 31, 63, "Input",ExpressionUUID->"f174efce-4a08-48b3-b084-c23fb802e5c3"],
Cell[104478, 2534, 495, 9, 31, "Text",ExpressionUUID->"4fd74434-49b1-401c-84d3-e5a4fa65579f"],
Cell[104976, 2545, 599, 13, 26, "Input",ExpressionUUID->"fa10fc7c-59e8-442b-a71d-eb629c7eef47"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

